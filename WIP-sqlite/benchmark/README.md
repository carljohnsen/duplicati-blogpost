# Prerequisites

- .NET 8 SDK (for building Duplicati)
- .NET 9 SDK (for building the C# benchmarks)
- A C++ compiler (`g++` for Linux, `g++-15` for Mac, and Visual Studio's `cl` for Windows)
- Python 3 (for running the plotting and analysis scripts)
- Git (for cloning the Duplicati repository)
- SQLite3 (system install for Mac/Linux, the Windows make script will download its own)

# Building

Start by cloning the Duplicati repository and checking out the appropriate version:

```
mkdir lib
cd lib
git clone https://github.com/duplicati/duplicati.git
cd duplicati
git checkout v2.1.0.120_canary_2025-06-24
```

Then for Windows, run the `make_win.bat` script to download SQLite3, build the C++ benchmarks, and build the C# benchmarks:

```bat
.\make_win.bat
```

For Mac and Linux, run `make` to build the C++ benchmarks, and then build the C# benchmarks:

```make
make -j
```

# Running the benchmarks

The benchmarks can be run using the `run_all.sh` script on Mac/Linux or `run_all.bat` on Windows. This will execute all the benchmarks and generate CSV files with the results in the `reports` directory.

```sh
./run_all.sh
```

or

```bat
.\run_all.bat
```

# Running the Duplicati comparisons

To compare the performance of Duplicati with different SQLite backends, you can use the `run_duplicati.sh` script on Mac/Linux or `run_duplicati.ps1` on Windows. This will run Duplicati with both the old and new SQLite backends and generate log file summaries for later analysis.

```sh
./run_duplicati.sh
```

or

```powershell
.\run_duplicati.ps1
```

# Analyzing the results

The results can be analyzed using the provided Jupyter notebook `plotting.ipynb`. This notebook will read the CSV files generated by the benchmarks and create plots in the `figures` directory. To change which `reports` folder is used, modify the `machine = '_win'` line in the second cell of the notebook (e.g., change `'_win'` to `''` to run the freshly generated reports in the `reports` folder).

For the Duplicati comparisons, the log file summaries will be moved to the `reports` folder as well, and can be pretty printed using the `timings_diff.py` script:

```sh
python3 timings_diff.py
```

To change which `reports` folder is used, modify the `postfixes = ...` array on line 5 to match the folders you want to print the results from. E.g. change to `postfixes = ['']` to print the freshly generated reports in the `reports` folder.
